package emi.indo.cordova.plugin.unityads;import android.util.Log;import android.view.Gravity;import android.view.ViewGroup;import android.widget.LinearLayout;import android.widget.RelativeLayout;import com.unity3d.ads.IUnityAdsInitializationListener;import com.unity3d.ads.IUnityAdsLoadListener;import com.unity3d.ads.IUnityAdsShowListener;import com.unity3d.ads.UnityAds;import com.unity3d.services.banners.BannerErrorInfo;import com.unity3d.services.banners.BannerView;import com.unity3d.services.banners.UnityBannerSize;import com.unity3d.services.banners.UnityBanners;import com.unity3d.services.banners.api.Banner;import com.unity3d.services.banners.api.BannerListener;import com.unity3d.services.banners.view.BannerPosition;import org.apache.cordova.CordovaInterface;import org.apache.cordova.CordovaPlugin;import org.apache.cordova.CallbackContext;import org.apache.cordova.CordovaWebView;import org.apache.cordova.PluginResult;import org.json.JSONArray;import org.json.JSONException;import java.util.Objects;import android.view.View;import android.content.Context;import java.lang.reflect.Method;public class emiUnityAdsPlugin extends CordovaPlugin{private static final String TAG="emiUnityAdsPlugin";private CallbackContext PUBLIC_CALLBACKS=null;private CordovaWebView cWebView;private RelativeLayout bannerViewLayout;private BannerView bannerView;public void initialize(CordovaInterface cordova,CordovaWebView webView){super.initialize(cordova,webView);cWebView=webView;}public boolean execute(String action,JSONArray args,final CallbackContext callbackContext)throws JSONException{PUBLIC_CALLBACKS=callbackContext;switch(action){case "unitySdkInitialize":cordova.getActivity().runOnUiThread(new Runnable(){public void run(){final String unityGameID=args.optString(0);UnityAds.initialize(cordova.getActivity(),unityGameID,new IUnityAdsInitializationListener(){@Override public void onInitializationComplete(){cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onInitializationComplete');");}@Override public void onInitializationFailed(UnityAds.UnityAdsInitializationError error,String message){cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onInitializationFailed');");}});}});return true;case "showBannerAd":cordova.getActivity().runOnUiThread(new Runnable(){public void run(){final String bannerPlacementId=args.optString(0);if(bannerViewLayout==null){bannerView=null;bannerViewLayout=new RelativeLayout(cordova.getActivity());RelativeLayout.LayoutParams params=new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT,RelativeLayout.LayoutParams.MATCH_PARENT);bannerViewLayout.setLayoutParams(params);((ViewGroup)Objects.requireNonNull(cWebView.getView())).addView(bannerViewLayout);}if(bannerView==null){bannerView=new BannerView(cordova.getActivity(),bannerPlacementId,new UnityBannerSize(320,50));bannerView.setListener(bannerListener);RelativeLayout.LayoutParams bannerParams=new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.WRAP_CONTENT,RelativeLayout.LayoutParams.WRAP_CONTENT);bannerParams.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM);bannerParams.addRule(RelativeLayout.CENTER_HORIZONTAL);bannerView.setLayoutParams(bannerParams);bannerView.load();bannerViewLayout.addView(bannerView);}}});return true;case "hideBannerAd":cordova.getActivity().runOnUiThread(new Runnable(){public void run(){bannerView.destroy();bannerView=null;}});return true;case "showInterstitialAd":cordova.getActivity().runOnUiThread(new Runnable(){public void run(){final String InterstitialPlacementId=args.optString(0);UnityAds.load(InterstitialPlacementId,new IUnityAdsLoadListener(){@Override public void onUnityAdsAdLoaded(String placementId){cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsAdLoaded.Interstitial');");UnityAds.show(cordova.getActivity(),InterstitialPlacementId,new IUnityAdsShowListener(){@Override public void onUnityAdsShowFailure(String placementId,UnityAds.UnityAdsShowError error,String message){Log.e("UnityAdsExample","Unity Ads failed to show ad for "+placementId+" with error:["+error+"]"+message);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowFailure.Interstitial');");}@Override public void onUnityAdsShowStart(String placementId){Log.v("UnityAdsExample","onUnityAdsShowStart: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowStart.Interstitial');");}@Override public void onUnityAdsShowClick(String placementId){Log.v("UnityAdsExample","onUnityAdsShowClick: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowClick.Interstitial');");}@Override public void onUnityAdsShowComplete(String placementId,UnityAds.UnityAdsShowCompletionState state){Log.v("UnityAdsExample","onUnityAdsShowComplete: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowComplete.Interstitial');");}});}@Override public void onUnityAdsFailedToLoad(String placementId,UnityAds.UnityAdsLoadError error,String message){Log.e("UnityAdsExample","Unity Ads failed to load ad for "+placementId+" with error:["+error+"]"+message);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsFailedToLoad.Interstitial');");}});}});return true;case "showVideoAd":cordova.getActivity().runOnUiThread(new Runnable(){public void run(){final String videoPlacementId=args.optString(0);UnityAds.load(videoPlacementId,new IUnityAdsLoadListener(){@Override public void onUnityAdsAdLoaded(String placementId){cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsAdLoaded.video');");UnityAds.show(cordova.getActivity(),videoPlacementId,new IUnityAdsShowListener(){@Override public void onUnityAdsShowFailure(String placementId,UnityAds.UnityAdsShowError error,String message){Log.e("UnityAdsExample","Unity Ads failed to show ad for "+placementId+" with error:["+error+"]"+message);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowFailure.video');");}@Override public void onUnityAdsShowStart(String placementId){Log.v("UnityAdsExample","onUnityAdsShowStart: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowStart.video');");}@Override public void onUnityAdsShowClick(String placementId){Log.v("UnityAdsExample","onUnityAdsShowClick: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowClick.video');");}@Override public void onUnityAdsShowComplete(String placementId,UnityAds.UnityAdsShowCompletionState state){Log.v("UnityAdsExample","onUnityAdsShowComplete: "+placementId);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsShowComplete.video');");}});}@Override public void onUnityAdsFailedToLoad(String placementId,UnityAds.UnityAdsLoadError error,String message){Log.e("UnityAdsExample","Unity Ads failed to load ad for "+placementId+" with error:["+error+"]"+message);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onUnityAdsFailedToLoad.video');");}});}});return true;}return false;}private final BannerView.IListener bannerListener=new BannerView.IListener(){@Override public void onBannerLoaded(BannerView bannerAdView){Log.v("UnityAdsExample","onBannerLoaded: "+bannerAdView.getPlacementId());cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onBannerLoaded');");}@Override public void onBannerFailedToLoad(BannerView bannerAdView,BannerErrorInfo errorInfo){Log.e("UnityAdsExample","Unity Ads failed to load banner for "+bannerAdView.getPlacementId()+" with error:["+errorInfo.errorCode+"]"+errorInfo.errorMessage);cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onBannerFailedToLoad');");}@Override public void onBannerClick(BannerView bannerAdView){Log.v("UnityAdsExample","onBannerClick: "+bannerAdView.getPlacementId());cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onBannerClick');");}@Override public void onBannerLeftApplication(BannerView bannerAdView){Log.v("UnityAdsExample","onBannerLeftApplication: "+bannerAdView.getPlacementId());cWebView.loadUrl("javascript:cordova.fireDocumentEvent('onBannerLeftApplication');");}};} 
